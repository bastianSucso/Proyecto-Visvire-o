<div class="space-y-6" (click)="errorMsg && (errorMsg = '')">
  <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-xl font-semibold text-slate-900">Disponibilidad</h1>
      <p class="text-sm text-slate-500">
        Listado de habitaciones disponibles por rango.
      </p>
    </div>
    <div class="flex items-center gap-2">
      <a
        class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 hover:bg-slate-50"
        routerLink="/pos/alojamiento"
      >
        ← Volver
      </a>
      <button
        class="rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
        (click)="refreshDisponibles()"
      >
        Refrescar disponibilidad
      </button>
    </div>
  </div>

  <div *ngIf="errorMsg" class="rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
    {{ errorMsg }}
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white p-4">
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex flex-wrap items-center gap-2">
        <span class="text-sm text-slate-600">Rango</span>
        <input
          type="datetime-local"
          class="rounded-lg border px-2 py-2 text-sm"
          [(ngModel)]="rangeFrom"
          (change)="onRangeChange()"
        />
        <span class="text-sm text-slate-400">→</span>
        <input
          type="datetime-local"
          class="rounded-lg border px-2 py-2 text-sm"
          [(ngModel)]="rangeTo"
          (change)="onRangeChange()"
        />
        <span class="text-xs text-slate-500">
          Disponibles: <strong>{{ availableRooms.length }}</strong>
        </span>
      </div>
      <div class="flex flex-wrap items-center gap-2 text-xs text-slate-500">
        <span class="inline-flex items-center gap-1">
          <span class="h-2 w-2 rounded-full bg-emerald-400"></span> Disponible
        </span>
        <span class="inline-flex items-center gap-1">
          <span class="h-2 w-2 rounded-full bg-amber-400"></span> Ocupada
        </span>
        <span class="inline-flex items-center gap-1">
          <span class="h-2 w-2 rounded-full bg-slate-300"></span> Inactiva
        </span>
      </div>
    </div>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white p-4">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <div class="text-xs uppercase tracking-wide text-slate-400">Habitaciones disponibles</div>
        <div class="text-sm font-semibold text-slate-800">Vista rápida</div>
      </div>
      <div class="flex items-center gap-2">
        <input
          [(ngModel)]="filtro"
          (ngModelChange)="page=1"
          placeholder="Buscar por ID, cama o comodidad..."
          class="w-full max-w-xs rounded-xl border border-slate-200 px-3 py-2 text-sm"
        />
        <select
          [(ngModel)]="pageSize"
          (ngModelChange)="page=1"
          class="rounded-xl border border-slate-200 px-3 py-2 text-sm"
        >
          <option [ngValue]="5">5</option>
          <option [ngValue]="10">10</option>
          <option [ngValue]="20">20</option>
        </select>
      </div>
    </div>

    <div class="mt-4 overflow-x-auto rounded-xl border border-slate-200">
      <table class="w-full text-left text-sm">
        <thead class="bg-slate-50 text-slate-600">
          <tr>
            <th class="px-4 py-3">Habitación</th>
            <th class="px-4 py-3">Piso</th>
            <th class="px-4 py-3">Precio</th>
            <th class="px-4 py-3">Tipo cama</th>
            <th class="px-4 py-3">Camas</th>
            <th class="px-4 py-3">Comodidades</th>
          </tr>
        </thead>
        <tbody class="text-slate-800">
          <tr *ngIf="loadingDisponibles">
            <td class="px-4 py-4 text-slate-500" colspan="6">
              Cargando disponibilidad...
            </td>
          </tr>
          <tr *ngFor="let room of pageItems" class="border-t border-slate-100">
            <td class="px-4 py-3 font-medium">{{ room.identificador }}</td>
            <td class="px-4 py-3 text-slate-600">{{ room.pisoZona?.nombre ?? '-' }}</td>
            <td class="px-4 py-3">
              {{ +room.precio | currency:'CLP':'symbol-narrow':'1.0-0' }}
            </td>
            <td class="px-4 py-3 text-xs text-slate-600">
              <ng-container *ngIf="bedCounts(room).one > 0">1 plaza ({{ bedCounts(room).one }})</ng-container>
              <ng-container *ngIf="bedCounts(room).two > 0">
                <span *ngIf="bedCounts(room).one > 0"> · </span>2 plazas ({{ bedCounts(room).two }})
              </ng-container>
              <span *ngIf="bedCounts(room).one === 0 && bedCounts(room).two === 0">Sin detalle</span>
            </td>
            <td class="px-4 py-3">
              <span class="rounded-full bg-slate-100 px-2 py-1 text-xs text-slate-700">
                {{ bedTotal(room) }}
              </span>
            </td>
            <td class="px-4 py-3">
              <div class="flex flex-wrap gap-1">
                <span
                  *ngFor="let c of room.comodidades"
                  class="rounded-full border border-slate-200 bg-slate-100 px-2 py-1 text-[11px] text-slate-700"
                >
                  {{ c.nombre }}
                </span>
                <span *ngIf="room.comodidades.length === 0" class="text-xs text-slate-400">Sin comodidades</span>
              </div>
            </td>
          </tr>
          <tr *ngIf="!loadingDisponibles && pageItems.length === 0">
            <td class="px-4 py-6 text-slate-500" colspan="6">
              No hay habitaciones disponibles para el rango seleccionado.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-4 flex items-center justify-between gap-3 text-sm text-slate-500">
      <div>
        Mostrando {{ (page - 1) * pageSize + (pageItems.length ? 1 : 0) }} -
        {{ (page - 1) * pageSize + pageItems.length }} de {{ filteredRooms.length }}
      </div>
      <div class="flex items-center gap-2">
        <button class="rounded-lg border px-2 py-1" (click)="page = 1" [disabled]="page === 1">«</button>
        <button class="rounded-lg border px-2 py-1" (click)="prevPage()" [disabled]="page === 1">Anterior</button>
        <span>Página {{ page }} / {{ totalPages }}</span>
        <button class="rounded-lg border px-2 py-1" (click)="nextPage()" [disabled]="page === totalPages">Siguiente</button>
        <button class="rounded-lg border px-2 py-1" (click)="page = totalPages" [disabled]="page === totalPages">»</button>
      </div>
    </div>
  </div>
</div>
